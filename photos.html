<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photos - Naomi Jong</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="gallery.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@200;300;400;500;600&display=swap" rel="stylesheet">
</head>
<body class="gallery-page">
    <nav>
        <div class="nav-left">
            <a href="/" class="nav-logo">Naomi Jong</a>
        </div>
        <div class="nav-links">
            <div class="dropdown">
                <button class="dropdown-toggle">Projects</button>
                <div class="dropdown-menu">
                    <a href="https://2cool2die.pythonanywhere.com" target="_blank">Credit Card Tracker</a>
                </div>
            </div>
            <a href="photos.html" class="active">Photos</a>
            <a href="registry.html">Baby Registry</a>
            <a href="#">Contact</a>
        </div>
    </nav>

    <main class="gallery-container">
        <h1 class="gallery-title">Photos</h1>

        <div class="masonry" id="gallery"></div>

        <p class="gallery-empty" id="emptyMsg">Loading...</p>
    </main>

    <div class="lightbox" id="lightbox">
        <button class="lightbox-close">&times;</button>
        <button class="lightbox-prev">&#8249;</button>
        <button class="lightbox-next">&#8250;</button>
        <img src="" alt="" id="lightboxImg">
    </div>

    <script>
        // Dropdown toggle
        document.querySelector('.dropdown-toggle').addEventListener('click', function () {
            this.parentElement.classList.toggle('open');
        });
        document.addEventListener('click', function (e) {
            if (!e.target.closest('.dropdown')) {
                document.querySelector('.dropdown').classList.remove('open');
            }
        });

        // Auto-load photos from GitHub repo
        const REPO = 'leojong/naomijong_website';
        const PHOTO_DIR = 'photos';
        const IMAGE_EXT = ['.jpg', '.jpeg', '.png', '.webp', '.gif'];

        function renderPhotos(names) {
            names.forEach((name, i) => {
                const img = document.createElement('img');
                img.src = `${PHOTO_DIR}/${name}`;
                img.alt = name.replace(/\.[^.]+$/, '').replace(/[-_]/g, ' ');
                img.loading = 'lazy';
                img.style.animationDelay = `${i * 0.05}s`;
                gallery.appendChild(img);
            });
            updateGallery();
        }

        async function loadPhotos() {
            try {
                // Try local manifest first (works locally + on prod)
                const local = await fetch('photos.json');
                if (local.ok) {
                    const names = await local.json();
                    return renderPhotos(names);
                }
            } catch (e) {}

            try {
                // Fallback: GitHub API (works on prod even without photos.json)
                const resp = await fetch(`https://api.github.com/repos/${REPO}/contents/${PHOTO_DIR}`);
                if (!resp.ok) throw new Error(resp.status);
                const files = await resp.json();
                const names = files
                    .filter(f => IMAGE_EXT.some(ext => f.name.toLowerCase().endsWith(ext)))
                    .map(f => f.name)
                    .sort();
                return renderPhotos(names);
            } catch (e) {
                emptyMsg.textContent = 'No photos yet. Check back soon!';
            }
        }

        // Lightbox
        const gallery = document.getElementById('gallery');
        const lightbox = document.getElementById('lightbox');
        const lightboxImg = document.getElementById('lightboxImg');
        const emptyMsg = document.getElementById('emptyMsg');
        let images = [];
        let currentIndex = 0;

        function updateGallery() {
            images = Array.from(gallery.querySelectorAll('img'));
            emptyMsg.style.display = images.length === 0 ? 'block' : 'none';
        }

        function openLightbox(index) {
            currentIndex = index;
            lightboxImg.src = images[index].src;
            lightboxImg.alt = images[index].alt;
            lightbox.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeLightbox() {
            lightbox.classList.remove('active');
            document.body.style.overflow = '';
        }

        function navigate(dir) {
            currentIndex = (currentIndex + dir + images.length) % images.length;
            lightboxImg.src = images[currentIndex].src;
            lightboxImg.alt = images[currentIndex].alt;
        }

        gallery.addEventListener('click', function (e) {
            if (e.target.tagName === 'IMG') {
                updateGallery();
                openLightbox(images.indexOf(e.target));
            }
        });

        document.querySelector('.lightbox-close').addEventListener('click', closeLightbox);
        document.querySelector('.lightbox-prev').addEventListener('click', () => navigate(-1));
        document.querySelector('.lightbox-next').addEventListener('click', () => navigate(1));

        lightbox.addEventListener('click', function (e) {
            if (e.target === lightbox) closeLightbox();
        });

        document.addEventListener('keydown', function (e) {
            if (!lightbox.classList.contains('active')) return;
            if (e.key === 'Escape') closeLightbox();
            if (e.key === 'ArrowLeft') navigate(-1);
            if (e.key === 'ArrowRight') navigate(1);
        });

        loadPhotos();
    </script>
</body>
</html>
